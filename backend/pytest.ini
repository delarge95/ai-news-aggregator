[tool:pytest]
# Pytest configuration for AI News Aggregator
# Comprehensive testing setup with coverage integration

# Test discovery
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Minimum Python version
minversion = 6.0

# Add options
addopts = 
    # Coverage integration
    --cov=app
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-report=json:coverage.json
    --cov-config=.coveragerc
    --cov-fail-under=80
    --cov-branch
    
    # Test output
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --showlocals
    --durations=10
    --doctest-modules
    
    # Async support
    --asyncio-mode=auto
    
    # Test markers
    -m "not slow"

# Asyncio configuration
asyncio_mode = auto

# Test collection configuration
collect_ignore = 
    setup.py
    venv/
    .venv/
    node_modules/
    __pycache__/
    *.pyc
    migrations/

# Filter warnings
filterwarnings = 
    # Deprecation warnings from dependencies
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    
    # Ignore specific third-party warnings
    ignore::UserWarning:httpx.*
    ignore::UserWarning:transformers.*
    
    # Redis connection warnings (expected in tests)
    ignore:Redis.*:pytest.PytestUnraisableExceptionWarning
    
    # OpenAI API warnings (expected in mock tests)
    ignore:.*openai.*:UserWarning

# Timeout for individual tests (in seconds)
timeout = 30
timeout_method = thread

# Parallel execution settings (optional, requires pytest-xdist)
# addopts = -n auto

# Logging configuration for tests
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Auto-discovery settings
norecursedirs = .git .tox build dist *.egg node_modules __pycache__

# Coverage specific settings
coverage:backend: 
    # Backend coverage settings
    source = app
    omit = 
        */tests/*
        test_*.py
        conftest.py
        */migrations/*
        */celery_app.py
        */venv/*
        */virtualenv/*

# Mark slow tests to skip by default in CI
markers =
    slow: marks tests as slow running (deselect with '-m "not slow"')
    unit: marks tests as unit tests
    integration: marks tests as integration tests
    performance: marks tests as performance tests
    api: marks tests that require API keys
    redis: marks tests that require Redis
    celery: marks tests that require Celery
    openai: marks tests that require OpenAI API
    database: marks tests that require database access
    e2e: marks tests as end-to-end tests

# Environment variables for testing
env = 
    TESTING=true
    PYTHONPATH=.
    COVERAGE_CORE=sysmon